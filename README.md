# Zup-Challenge-Bank

This challenge was propose by Zup to subscribe in bootcamp 2020.2. The business rules can be found [here](https://trello.com/b/aiSaSAbi/nosso-banco-digital) (in Portuguese).

## Using the project

The project is up on **heroku** server and you can use it in this [link](https://zup-challenge-bank.herokuapp.com/).
Please, see **Routes** session to know how to consume it.

## Run project locally

First, you must guarantee docker and docker-compose are installed and work on your machine. After that, clone this repo and execute:
``` sh
$ docker-compose up -d
```

The command above creates a mysql database that will be used by the app to store all clients and accounts information.
After that, execute:
```sh
$ ./mvnw package -DskipTests
$ java -jar target/bank-0.0.1-SNAPSHOT.jar
```

By default, the app will be up on port **8080**.
See _/home/eduardo/eclipse-workspace/bank/src/main/resources/application.properties_ to change app variables. 

## Routes

All routes can be access on http://localhost:8080/v1/ (or, https://zup-challenge-bank.herokuapp.com/v1/). 
This is the first version of API. If in the future you decide to change the access form (add or remove fields on a header or body), you be able to change without break some app client that is consuming your old API version. 

### (POST) /v1/client-info

Registers the specific customer information.

**Request**:

**Body**: 
* **name**: customer's name
* **surname**: customer's surname
* **email**: customer's valid email.
* **cnh_number**: customer's CNH number (Carteira Nacional de Habilitação). It must be a **string**.
* **cpf**: customer's CPF number (Código de Pessoa Física). It must be a **string**.
* **birthday_date**: customer's birthday date. It must follow this form: "YYYY-MM-DD".

**Response**:

**Header**:
* **location**: next route (/v1/address).
* **token**: customer's CPF.

**Status code**:
* **201**: Created.
* **400**: Validation Error or CPF/email already registered.


### (POST) /v1/address

**Request**:

**Header**:
* **token**: customer's CPF.

**Body**:
* **cep**: customer's valid CEP address (Código de Endereçamento Postal). It must be a string.
* **street**: customer's street address.
* **city** : customer's city.
* **state**: customer's state
* **neighborhood** : customer's neighborhood address.
* **complement**: customer's complement address.


**Response**:

**Header**:
* **location**: next route (/v1/cnh).
* **token**: customer's CPF.

**Status code**:
* **201**: Created.
* **400**: Validation Error or CPF not found.


### (POST) /v1/cnh

**Request**:

**Header**:
* **token**: customer's CPF.

**Body**:
* **cnh_front_url**: customer's valid image URL CNH front.
* **cnh_back_url**: customer's valid image URL CNH back.

**Response**:

**Header**:
* **location**: next route (/v1/cnh).
* **token**: customer's CPF.

**Status code**:
* **201**: Created.
* **400**: Validation Error.
* **404**: CPF not found.
* **404**: previous steps must be completed.


### (GET) /v1/proposal

**Request**:

**Header**:
* **token**: customer's CPF.

**Response**:

**Body**:
 A summary with all before data.

**Status code**:
* **200**: Ok.
* **404**: CPF not found.
* **404**: previous steps must be completed.

### (POST) /v1/proposal?accept=true

Send an email with link to create an account.

**Request**:

**Header**:
* **token**: customer's CPF.

**Query Parameter**:
* **accept**: true | false

**Status code**:
* **200**: Ok.
* **404**: CPF not found.


### (GET) /v1/account/create

Creates an account and send via email the information about it.

**Request**:

**Query Parameter**:
* **token**: A temporary token generated by server side.


**Response**

**Status code**:
* **200**: Ok.
* **422**: Account already created.
* **500**: Token validation errors (invalid or expired).

### (POST) /v1/account/confirm

Confirm your user information and creates a token to logon that will be sent to email.

**Request**:

**Body**:
* **cpf**: customer's CPF number (Código de Pessoa Física). It must be a **string**.
* **email**: customer's valid email.

**Response**:

**Status code**:
* **200**: Ok.
* **404**: user not found.

### (POST) /v1/user/logon

Create a user after confirmation.

**Request**:

**Body**:
* **cpf**: customer's CPF number (Código de Pessoa Física). It must be a **string**.
* **token**: customer's valid email.
* **password**: customer's valid password.

**Response**:

**Status code**:
* **201**: Created.
* **400**: Expired/Revoked token.

## How to test/consume this API via Insomnia

If you want test/consume this API using Insomnia, you can import the file below to your Insomnia environment.

* [zup-bank-local](insomnia-env/zup-bank-local.json)
* [zup-bank-heroku](insomnia-env/zup-bank-local.json)
